## Analysis of a reversible reaction 

```{python}
#| code-fold: true
import matplotlib.pyplot as plt
import numpy as np
```

Consider the following reaction 

$$
A \underset{k_{2}}{\stackrel{k_1}{\rightleftharpoons}} B
$$

The magnitudes of the rate constants are $k_1 = 10 \ \mathrm{s}^{-1}$ and $k_2 = 1 \ \mathrm{s}^{-1}$.

#### (a) Reaction order

What is the reaction order in each direction?

```{python}
#| solution: true
#| output: asis
#| echo: false
answer=r"""
::: {.callout-important}

## Answer

Two perspectives

From the chemical equation: Each elementary step involves only one reactant molecule:

- Forward reaction: A → B (one molecule of A)
- Reverse reaction: B → A (one molecule of B)
   
Since each step involves a single reactant, both are first-order reactions.

From the units: The rate constants have units of $\mathrm{s}^{-1}$, which is the unit of first order reactions.
:::
"""
print(answer)
```

#### (b) Derive equilibrium constant 

Show mathematically how the equilibrium constant $K_{\mathrm{eq}}$ is given by the ratio between the two rate constants.

```{python}
#| solution: true
#| output: asis
#| echo: false
answer=r"""
::: {.callout-important}

## Answer
At equilibrium, the forward and reverse reaction rates are equal:

$$r_{\text{forward}} = r_{\text{reverse}}$$

For the reaction $A \rightleftharpoons B$, both are first order as discussed above:

- Forward rate: $r_{\text{forward}} = k_1[A]_{\text{eq}}$
- Reverse rate: $r_{\text{reverse}} = k_2[B]_{\text{eq}}$

Setting them equal:
$$k_1[A]_{\text{eq}} = k_2[B]_{\text{eq}}$$

Rearranging to solve for the ratio of concentrations:
$$\frac{[B]_{\text{eq}}}{[A]_{\text{eq}}} = \frac{k_1}{k_2}$$

By definition, the equilibrium constant is:
$$K_{\text{eq}} = \frac{[B]_{\text{eq}}}{[A]_{\text{eq}}}$$

Therefore:
$$K_{\text{eq}} = \frac{k_1}{k_2}$$

:::
"""
print(answer)
```

#### (c) Calculate $K_{\mathrm{eq}}$

```{python}
#| exercise: true
#| eval: false

## Your task: Assign known values & calculate the equilibrium constant.
k1 = ...
k2 = ...
K_eq = ...
print(K_eq)
```

```{python}
#| solution: true

## Your task: Assign known values & calculate the equilibrium constant.
k1 = 10 
k2 = 1
K_eq = k1 / k2
print(K_eq)
```

#### (d) Equilibrium concentrations 

Calculate the concentrations of A and B at equilibrium, $[\mathrm{A}]_{\mathrm{eq}}$ and $[\mathrm{B}]_\mathrm{eq}$, if $[\mathrm{A}]_0 = 10^{-3} \text{M}$

```{python}
#| exercise: true
#| eval: false

## Your task: Assign known values and calculate the concentrations at equilibrium.
A0 = ...
A_eq = ...
B_eq = ...
print(A_eq)
print(B_eq)
```

```{python}
#| solution: true
A0 = 10**(-3)
A_eq = (k2 * A0) / (k1 + k2)
B_eq = (k1 * A0) / (k1 + k2)
print(A_eq)
print(B_eq)
```

#### (e) Initial rate of formation 

If $[\mathrm{A}]_0 = 10^{-3} \ \text{M}$ and $[\mathrm{B}]_0 = 0 \ \text{M}$, calculate the initial rate of formation of B.

```{python}
#| exercise: true
#| eval: false

## Your task: Calculate initial rate of formation of B
r_fwd = ...
print(r_fwd)
```

```{python}
#| solution: true
## Your task: Calculate initial rate of formation of B
r_fwd = A0 * k1
print(r_fwd)
```

#### (f) Time-dependence

![](https://raw.githubusercontent.com/au-mbg/fysisk-biokemi/refs/heads/main/course/lessons/figures/week_48/reversible_reaction.png){.lightbox}

We now want to calculate and plot the time-dependent concentrations using the above equations. 

In the cell below finish the implementation of the function `A_time` that calculates 
the concentration [A] as a function of time.

```{python}
#| exercise: true
#| eval: false

## Your task: Implement the function to calculate the time dependent concentration.
## Be careful with parentheses.
def A_time(t, A0, k_f, k_b):
    A_t = ...
    return A_t

test = A_time(1, 1, 1, 1)
print(test) # This should give 0.567...
```

```{python}
#| solution: true

## Your task: Implement the function to calculate the time dependent concentration.
## Be careful with parentheses.
def A_time(t, A0, k_f, k_b):
    A_t = (k_b + k_f * np.exp(-(k_f+k_b)*t)) / (k_f + k_b) * A0
    return A_t


test = A_time(1, 1, 1, 1)
print(test) # This should give 0.567...
```

And then we can use that function to calculate and plot the concentrations as a function of time. 
As you have seen above, the reaction is pretty fast, so we will just focus on the first second

```{python}
#| exercise: true
#| eval: false
fig, ax = plt.subplots()
t = np.linspace(0, 1, 100)

## Your task: Calculate [A](t) and [B](t) ##
At = ... # Use your function to calculate [A](t)
Bt = ... # Calculate [B](t)

## Plots the concentrations versus time.
ax.plot(t, At, label='[A](t)')
ax.plot(t, Bt, label='[B](t)')

## EXTRA: Sets x and y-axis labels. 
ax.set_ylabel('Concentrations (M)')
ax.set_xlabel('Time (s)')
ax.legend()
```

```{python}
#| solution: true
fig, ax = plt.subplots()
t = np.linspace(0, 1, 100)

## Your task: Calculate [A](t) and [B](t) ##
At = A_time(t, A0, k1, k2)
Bt = A0 - At

## Plots the concentrations versus time.
ax.plot(t, At, label='[A](t)')
ax.plot(t, Bt, label='[B](t)')

## EXTRA: Sets x and y-axis labels. 
ax.set_ylabel('Concentrations (M)', fontsize=14)
ax.set_xlabel('Time (s)', fontsize=14)
ax.legend()
```
